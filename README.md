# gonverter

Type-safe code generator for Go struct conversions, inspired by Kubernetes conversion-gen.

## Installation

```bash
go install github.com/sivchari/gonverter/cmd/gonverter@latest
```

## Quick Start

### 1. Define your types

```go
// handler/user.go
package handler

type UserRequest struct {
    FullName string
    Email    string
    Age      int
    Address  AddressRequest
}

type AddressRequest struct {
    City    string
    ZipCode string
}

// domain/user.go
package domain

type User struct {
    Name    string  // Note: different field name
    Email   string
    Age     int
    Address Address
}

type Address struct {
    City    string
    ZipCode string
}
```

### 2. Register conversions

```go
//go:build gonverter

//go:generate gonverter .

package converter

import (
    "myapp/domain"
    "myapp/handler"
    "github.com/sivchari/gonverter/runtime"
)

// Register the conversion pair
var _ = runtime.Register[*handler.UserRequest, *domain.User]()
```

### 3. Generate code

```bash
go generate ./converter
```

### 4. Generated code

```go
// Code generated by gonverter. DO NOT EDIT.

package converter

// ConvertUserRequestToUser converts UserRequest to User
func ConvertUserRequestToUser(src *handler.UserRequest, dst *domain.User) {
    if src == nil {
        return
    }

    ConvertUserRequestNameToUserName(src, dst)  // Needs custom implementation
    dst.Email = src.Email  // Automatic mapping
    dst.Age = src.Age      // Automatic mapping
    ConvertAddressRequestToAddress(&src.Address, &dst.Address)  // Nested struct
}

// ConvertAddressRequestToAddress converts AddressRequest to Address
func ConvertAddressRequestToAddress(src *handler.AddressRequest, dst *domain.Address) {
    if src == nil {
        return
    }

    dst.City = src.City
    dst.ZipCode = src.ZipCode
}
```

### 5. Implement custom conversions

Since `FullName` -> `Name` cannot be mapped automatically, implement the conversion function:

```go
// converter/custom.go
package converter

func ConvertUserRequestNameToUserName(src *handler.UserRequest, dst *domain.User) {
    dst.Name = src.FullName  // Your custom logic
}
```

### 6. Use it

```go
req := &handler.UserRequest{
    FullName: "John Doe",
    Email:    "john@example.com",
    Age:      30,
    Address: handler.AddressRequest{
        City:    "Tokyo",
        ZipCode: "100-0001",
    },
}

user := &domain.User{}
converter.ConvertUserRequestToUser(req, user)

fmt.Println(user.Name)           // "John Doe"
fmt.Println(user.Address.City)   // "Tokyo"
```
